<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-03 Fri 12:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Day10</title>
<meta name="author" content="Abhishek Raj" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Day10</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgdaed013">1. Scripts</a>
<ul>
<li><a href="#org7b2040d">1.1. compile script</a></li>
<li><a href="#org93a788a">1.2. run script</a></li>
</ul>
</li>
<li><a href="#orgf010a86">2. Introduction to MPI</a></li>
<li><a href="#org3525c94">3. Basics of MPI</a></li>
<li><a href="#org2f0586c">4. Processes vs Threads</a></li>
<li><a href="#org80f6ada">5. Distributed Memory Programming Model</a></li>
<li><a href="#org9ea9396">6. Distributed vs Shared Memory</a></li>
<li><a href="#org30a6431">7. Why MPI?</a></li>
<li><a href="#org7a22f72">8. Real-World Applications of MPI</a></li>
<li><a href="#org592ce7a">9. How MPI Works</a></li>
<li><a href="#org0655c71">10. MPI Communications</a></li>
<li><a href="#org9ab7d87">11. Downloading and Installing MPI</a></li>
<li><a href="#org510d1a9">12. Loading MPI on PARAM shavak</a></li>
<li><a href="#org847e9ec">13. MPI Hello World Example</a></li>
<li><a href="#orgf5eff13">14. Detailed Explanation of Hello World Code</a></li>
<li><a href="#org6b73752">15. Hello World in C</a>
<ul>
<li><a href="#org3393031">15.1. code</a></li>
<li><a href="#org2ecb2a2">15.2. compile</a></li>
<li><a href="#orgc50165f">15.3. run</a></li>
</ul>
</li>
<li><a href="#orge546f37">16. Hello World in using MPI</a>
<ul>
<li><a href="#org9190f70">16.1. code</a></li>
<li><a href="#orgc0692d2">16.2. compile</a></li>
<li><a href="#orgd7ef654">16.3. run</a></li>
</ul>
</li>
<li><a href="#orgc78fa0a">17. task1</a></li>
<li><a href="#orge5a0c28">18. Point-to-point communication</a>
<ul>
<li><a href="#org057d2fe">18.1. Sending array to process 1</a></li>
</ul>
</li>
<li><a href="#orgcad3e0f">19. Point to point communication</a>
<ul>
<li><a href="#orge995282">19.1. Better way</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgdaed013" class="outline-2">
<h2 id="orgdaed013"><span class="section-number-2">1.</span> Scripts</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org7b2040d" class="outline-3">
<h3 id="org7b2040d"><span class="section-number-3">1.1.</span> compile script</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">!/bin/</span><span style="color: #e45649;">sh</span>

<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">source /opt/ohpc/pub/apps/spack/share/spack/setup-env.sh</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">spack load gcc/5i5y5cb</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">spack load openmpi/c7kvqyq</span>
<span style="color: #a626a4;">source</span> ~/git/spack/share/spack/setup-env.sh
spack load openmpi

<span style="color: #6a1868;">inputFile</span>=$<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #6a1868;">outputFile</span>=<span style="color: #50a14f;">"</span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">{1%.*}</span><span style="color: #50a14f;">.out"</span>      <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">extract the name of the file without extension and adding extension .out</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">cmd=`mpicc $inputFile -o $outputFile`</span>
<span style="color: #6a1868;">cmd</span>=<span style="color: #50a14f;">"mpicc </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">inputFile</span><span style="color: #50a14f;"> -o </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">outputFile</span><span style="color: #50a14f;">"</span>     <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">running code using MPI</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"------------------------------------------------------------------"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"Command executed: </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">cmd</span><span style="color: #50a14f;">"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"------------------------------------------------------------------"</span>
$<span style="color: #6a1868;">cmd</span>

<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"Compilation successful. Check at </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">outputFile</span><span style="color: #50a14f;">"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"------------------------------------------------------------------"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org93a788a" class="outline-3">
<h3 id="org93a788a"><span class="section-number-3">1.2.</span> run script</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">!/bin/</span><span style="color: #e45649;">sh</span>

<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">source /opt/ohpc/pub/apps/spack/share/spack/setup-env.sh</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">spack load gcc/5i5y5cbc</span>
<span style="color: #a626a4;">source</span> ~/git/spack/share/spack/setup-env.sh
spack load openmpi

<span style="color: #6a1868;">cmd</span>=<span style="color: #50a14f;">"mpirun -np </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">2</span><span style="color: #50a14f;"> </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">1</span><span style="color: #50a14f;">"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"------------------------------------------------------------------"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"Command executed: </span><span style="color: #b751b6;">$</span><span style="color: #6a1868;">cmd</span><span style="color: #50a14f;">"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"------------------------------------------------------------------"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##################################################################"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##########                    OUTPUT                    ##########"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##################################################################"</span>
<span style="color: #986801;">echo</span>
mpirun -np $<span style="color: #da8548; font-weight: bold;">2</span> $<span style="color: #da8548; font-weight: bold;">1</span>
<span style="color: #986801;">echo</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##################################################################"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##########                     DONE                     ##########"</span>
<span style="color: #986801;">echo</span> <span style="color: #50a14f;">"##################################################################"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf010a86" class="outline-2">
<h2 id="orgf010a86"><span class="section-number-2">2.</span> Introduction to MPI</h2>
<div class="outline-text-2" id="text-2">
<p>
MPI (Message Passing Interface) is a standardized library for message-passing in parallel programming. It allows multiple processes to communicate and coordinate tasks across distributed-memory systems. MPI is widely used for high-performance computing applications.
</p>

<ul class="org-ul">
<li><b><b>Key Highlights</b></b>:
<ul class="org-ul">
<li>Enables communication between processes running on different nodes or cores.</li>
<li>Portable across various hardware and software platforms.</li>
<li>Scalable to thousands or even millions of processes.</li>
<li>Provides fine-grained control over communication patterns.</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org3525c94" class="outline-2">
<h2 id="org3525c94"><span class="section-number-2">3.</span> Basics of MPI</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li><b><b>Processes</b></b>:
<ul class="org-ul">
<li>Each instance of an MPI program is a separate process.</li>
<li>Processes do not share memory and communicate explicitly via messages.</li>
</ul></li>

<li><b><b>Communicator</b></b>:
<ul class="org-ul">
<li>A group of processes that can communicate with each other.</li>
<li>The default communicator `MPI_COMM_WORLD` includes all processes.</li>
</ul></li>

<li><b><b>Rank</b></b>:
<ul class="org-ul">
<li>Each process in a communicator is assigned a unique <b><b>rank</b></b> (an integer).</li>
<li>Ranks are used to identify and address processes.</li>
</ul></li>

<li><b><b>Execution Model</b></b>:
<ul class="org-ul">
<li>All processes start execution from the same program code.</li>
<li>They can follow different execution paths based on their rank.</li>
</ul></li>
</ul>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org2f0586c" class="outline-2">
<h2 id="org2f0586c"><span class="section-number-2">4.</span> Processes vs Threads</h2>
<div class="outline-text-2" id="text-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><b><b>Feature</b></b></th>
<th scope="col" class="org-left"><b><b>Processes</b></b></th>
<th scope="col" class="org-left"><b><b>Threads</b></b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Memory</td>
<td class="org-left">Separate memory for each process.</td>
<td class="org-left">Shared memory within the process.</td>
</tr>

<tr>
<td class="org-left">Communication</td>
<td class="org-left">Message passing (explicit).</td>
<td class="org-left">Shared variables (implicit).</td>
</tr>

<tr>
<td class="org-left">Scalability</td>
<td class="org-left">Highly scalable.</td>
<td class="org-left">Limited by shared memory capacity.</td>
</tr>

<tr>
<td class="org-left">Example</td>
<td class="org-left">MPI programs.</td>
<td class="org-left">OpenMP programs.</td>
</tr>
</tbody>
</table>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org80f6ada" class="outline-2">
<h2 id="org80f6ada"><span class="section-number-2">5.</span> Distributed Memory Programming Model</h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>In distributed memory systems, processes execute on separate nodes, each with its own private memory.</li>
<li>Communication between processes occurs explicitly using message-passing.</li>

<li><b><b>Key Characteristics</b></b>:
<ul class="org-ul">
<li>No shared memory: Processes cannot directly access each other’s data.</li>
<li>Explicit communication: Processes exchange data via messages.</li>
<li>Suitable for large-scale distributed systems like clusters and supercomputers.</li>
</ul></li>
</ul>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org9ea9396" class="outline-2">
<h2 id="org9ea9396"><span class="section-number-2">6.</span> Distributed vs Shared Memory</h2>
<div class="outline-text-2" id="text-6">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left"><b><b>Feature</b></b></th>
<th scope="col" class="org-left"><b><b>Shared Memory</b></b></th>
<th scope="col" class="org-left"><b><b>Distributed Memory</b></b></th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b><b>Memory Access</b></b></td>
<td class="org-left">All threads share a global memory.</td>
<td class="org-left">Each process has private memory.</td>
</tr>

<tr>
<td class="org-left"><b><b>Communication</b></b></td>
<td class="org-left">Implicit via shared variables.</td>
<td class="org-left">Explicit via message passing.</td>
</tr>

<tr>
<td class="org-left"><b><b>Programming Models</b></b></td>
<td class="org-left">OpenMP, Pthreads.</td>
<td class="org-left">MPI, Sockets.</td>
</tr>

<tr>
<td class="org-left"><b><b>Scalability</b></b></td>
<td class="org-left">Limited by shared memory size.</td>
<td class="org-left">Highly scalable for large systems.</td>
</tr>
</tbody>
</table>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org30a6431" class="outline-2">
<h2 id="org30a6431"><span class="section-number-2">7.</span> Why MPI?</h2>
<div class="outline-text-2" id="text-7">
<ol class="org-ol">
<li><b><b>Scalability</b></b>:
<ul class="org-ul">
<li>Handles thousands of processes efficiently on distributed systems.</li>
</ul></li>

<li><b><b>Portability</b></b>:
<ul class="org-ul">
<li>Works on diverse hardware architectures and operating systems.</li>
</ul></li>

<li><b><b>Flexibility</b></b>:
<ul class="org-ul">
<li>Provides control over data distribution, load balancing, and communication.</li>
</ul></li>

<li><b><b>Efficiency</b></b>:
<ul class="org-ul">
<li>Optimized for high-performance computing on clusters and supercomputers.</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-org7a22f72" class="outline-2">
<h2 id="org7a22f72"><span class="section-number-2">8.</span> Real-World Applications of MPI</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>Climate modeling.</li>
<li>Computational fluid dynamics.</li>
<li>Genome sequencing.</li>
<li>Financial simulations.</li>
</ul>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org592ce7a" class="outline-2">
<h2 id="org592ce7a"><span class="section-number-2">9.</span> How MPI Works</h2>
<div class="outline-text-2" id="text-9">
<ol class="org-ol">
<li><b><b>Initialization</b></b>:
<ul class="org-ul">
<li>The MPI environment is set up using `MPI_Init`.</li>
<li>All processes start executing from the same program.</li>
</ul></li>

<li><b><b>Communication</b></b>:
<ul class="org-ul">
<li>Processes exchange data via point-to-point or collective communication.</li>
<li>Use communicators (e.g., `MPI_COMM_WORLD`) to define the scope of communication.</li>
</ul></li>

<li><b><b>Synchronization</b></b>:
<ul class="org-ul">
<li>Processes can synchronize using barriers or other mechanisms.</li>
</ul></li>

<li><b><b>Finalization</b></b>:
<ul class="org-ul">
<li>The MPI environment is cleaned up using `MPI_Finalize`.</li>
</ul></li>
</ol>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org0655c71" class="outline-2">
<h2 id="org0655c71"><span class="section-number-2">10.</span> MPI Communications</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li><b><b>Point-to-Point Communication</b></b>:
<ul class="org-ul">
<li>Direct communication between two specific processes.</li>
<li>Example Functions:
<ul class="org-ul">
<li>`MPI_Send`: Sends a message.</li>
<li>`MPI_Recv`: Receives a message.</li>
</ul></li>
</ul></li>

<li><b><b>Collective Communication</b></b>:
<ul class="org-ul">
<li>Involves all processes in a communicator.</li>
<li>Example Functions:
<ul class="org-ul">
<li>`MPI_Bcast`: Broadcasts a message to all processes.</li>
<li>`MPI_Reduce`: Combines data from all processes.</li>
</ul></li>
</ul></li>
</ul>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org9ab7d87" class="outline-2">
<h2 id="org9ab7d87"><span class="section-number-2">11.</span> Downloading and Installing MPI</h2>
<div class="outline-text-2" id="text-11">
<p>
To get started with MPI, you need to download and install an MPI implementation. Here are general steps for downloading and installing Open MPI:
</p>
<ol class="org-ol">
<li><b><b>Download Open MPI</b></b>:
Visit the [Open MPI website](<a href="https://www.open-mpi.org">https://www.open-mpi.org</a>) and download the latest version of Open MPI.</li>
<li><p>
<b><b>Extract the tarball</b></b>:
</p>
<div class="org-src-container">
<pre class="src src-sh">   tar -xvf openmpi-x.y.z.tar.gz
   <span style="color: #986801;">cd</span> openmpi-x.y.z
</pre>
</div></li>
<li><p>
<b><b>Configure, Build, and Install</b></b>:
</p>
<div class="org-src-container">
<pre class="src src-sh">   ./configure --prefix=/path/to/install
   <span style="color: #986801;">make</span>
   <span style="color: #986801;">make</span> install
</pre>
</div></li>
<li><p>
<b><b>Set Environment Variables</b></b>:
Add the following lines to your `.bashrc` or `.bash_profile`:
</p>
<div class="org-src-container">
<pre class="src src-sh">   <span style="color: #a626a4;">export</span> <span style="color: #6a1868;">PATH</span>=/path/to/install/bin:$<span style="color: #6a1868;">PATH</span>
   <span style="color: #a626a4;">export</span> <span style="color: #6a1868;">LD_LIBRARY_PATH</span>=/path/to/install/lib:$<span style="color: #6a1868;">LD_LIBRARY_PATH</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org510d1a9" class="outline-2">
<h2 id="org510d1a9"><span class="section-number-2">12.</span> Loading MPI on PARAM shavak</h2>
<div class="outline-text-2" id="text-12">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #a626a4;">source</span> /home/apps/spack/share/spack/setup.env.sh <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">source spack package manager</span>
spack <span style="color: #986801;">find</span> openmpi  <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">check if mpi is installed or not</span>
<span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">spack install -j40 openmpi   # if not installed then this command will install the latest version of openmpi</span>
spack load openmpi/_your_hash   <span style="color: #9ca0a4;"># </span><span style="color: #9ca0a4;">load mpi with specific has if multiple version is installed</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org847e9ec" class="outline-2">
<h2 id="org847e9ec"><span class="section-number-2">13.</span> MPI Hello World Example</h2>
<div class="outline-text-2" id="text-13">
<div class="org-src-container">
<pre class="src src-c"><span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;mpi.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span> <span style="color: #50a14f;">&lt;stdio.h&gt;</span>

<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">argc</span>, <span style="color: #986801;">char</span>** <span style="color: #6a1868;">argv</span>) {
    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Initialize the MPI environment</span>
    MPI_Init(&amp;argc, &amp;argv);

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Get the size of the communicator (number of processes)</span>
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">world_size</span>      ;
    MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Get the rank of the current process</span>
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">world_rank</span>;
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Print a message from each process</span>
    printf(<span style="color: #50a14f;">"Hello from process %d of %d\n"</span>, world_rank, world_size);

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Finalize the MPI environment</span>
    MPI_Finalize();
    <span style="color: #e45649;">return</span> <span style="color: #da8548; font-weight: bold;">0</span>;
}
</pre>
</div>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-orgf5eff13" class="outline-2">
<h2 id="orgf5eff13"><span class="section-number-2">14.</span> Detailed Explanation of Hello World Code</h2>
<div class="outline-text-2" id="text-14">
<ol class="org-ol">
<li><b><b>MPI_Init</b></b>:
<ul class="org-ul">
<li>Initializes the MPI environment.</li>
<li>Required before calling any other MPI functions.</li>
<li>Syntax:
```c
MPI_Init(&amp;argc, &amp;argv);
```</li>
</ul></li>

<li><b><b>MPI_COMM_WORLD</b></b>:
<ul class="org-ul">
<li>Default communicator that includes all processes in the MPI program.</li>
<li>Every process is part of this communicator.</li>
</ul></li>

<li><b><b>MPI_Comm_size</b></b>:
<ul class="org-ul">
<li>Retrieves the total number of processes in the communicator.</li>
<li>Syntax:
```c
MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);
```</li>
<li>Example:
<ul class="org-ul">
<li>If there are 4 processes, `world_size` will be `4`.</li>
</ul></li>
</ul></li>

<li><b><b>MPI_Comm_rank</b></b>:
<ul class="org-ul">
<li>Retrieves the rank of the current process in the communicator.</li>
<li>Syntax:
```c
MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);
```</li>
<li>Example:
<ul class="org-ul">
<li>If there are 4 processes, their ranks will be `0`, `1`, `2`, and `3`.</li>
</ul></li>
</ul></li>

<li><b><b>MPI_Finalize</b></b>:
<ul class="org-ul">
<li>Cleans up the MPI environment.</li>
<li>Syntax:
```c
MPI_Finalize();
```</li>
</ul></li>
</ol>

<p>
&#x2014;
</p>
</div>
</div>
<div id="outline-container-org6b73752" class="outline-2">
<h2 id="org6b73752"><span class="section-number-2">15.</span> Hello World in C</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-org3393031" class="outline-3">
<h3 id="org3393031"><span class="section-number-3">15.1.</span> code</h3>
<div class="outline-text-3" id="text-15-1">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;stdio.h&gt;</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(){
    printf(<span style="color: #50a14f;">"Hello, World\n"</span>);
    <span style="color: #e45649;">return</span> <span style="color: #da8548; font-weight: bold;">0</span>;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org2ecb2a2" class="outline-3">
<h3 id="org2ecb2a2"><span class="section-number-3">15.2.</span> compile</h3>
<div class="outline-text-3" id="text-15-2">
<div class="org-src-container">
<pre class="src src-bash">gcc hello.c -o hello.out
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc50165f" class="outline-3">
<h3 id="orgc50165f"><span class="section-number-3">15.3.</span> run</h3>
<div class="outline-text-3" id="text-15-3">
<div class="org-src-container">
<pre class="src src-bash">./hello.out
</pre>
</div>

<pre class="example">
Hello, World
</pre>
</div>
</div>
</div>
<div id="outline-container-orge546f37" class="outline-2">
<h2 id="orge546f37"><span class="section-number-2">16.</span> Hello World in using MPI</h2>
<div class="outline-text-2" id="text-16">
</div>
<div id="outline-container-org9190f70" class="outline-3">
<h3 id="org9190f70"><span class="section-number-3">16.1.</span> code</h3>
<div class="outline-text-3" id="text-16-1">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;stdio.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;mpi.h&gt;</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(){
    MPI_Init(<span style="color: #b751b6;">NULL</span>, <span style="color: #b751b6;">NULL</span>);
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span>;
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);

    <span style="color: #986801;">int</span> <span style="color: #6a1868;">rank</span>;
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
    printf(<span style="color: #50a14f;">"Hello from process %d of %d\n"</span>, rank, size);
    MPI_Finalize();
    <span style="color: #e45649;">return</span> <span style="color: #da8548; font-weight: bold;">0</span>;
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc0692d2" class="outline-3">
<h3 id="orgc0692d2"><span class="section-number-3">16.2.</span> compile</h3>
<div class="outline-text-3" id="text-16-2">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">source ~/git/spack/share/spack/setup-env.sh</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">spack load openmpi</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">mpicc hello.c</span>
bash compile.sh hello1.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc hello1.c -o hello1.out
------------------------------------------------------------------
Compilation successful. Check at hello1.out
------------------------------------------------------------------
</pre>
</div>
</div>
<div id="outline-container-orgd7ef654" class="outline-3">
<h3 id="orgd7ef654"><span class="section-number-3">16.3.</span> run</h3>
<div class="outline-text-3" id="text-16-3">
<div class="org-src-container">
<pre class="src src-bash"><span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">source ~/git/spack/share/spack/setup-env.sh</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">spack load openmpi</span>
<span style="color: #9ca0a4;">#</span><span style="color: #9ca0a4;">mpirun -np 4 ./a.out</span>
bash run.sh ./hello1.out <span style="color: #da8548; font-weight: bold;">4</span>
</pre>
</div>

<pre class="example" id="org34b0b21">
------------------------------------------------------------------
Command executed: mpirun -np 4 ./hello1.out
------------------------------------------------------------------
##################################################################
##########                    OUTPUT                    ##########
##################################################################

Hello from process 0 of 4
Hello from process 1 of 4
Hello from process 3 of 4
Hello from process 2 of 4

##################################################################
##########                     DONE                     ##########
##################################################################
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc78fa0a" class="outline-2">
<h2 id="orgc78fa0a"><span class="section-number-2">17.</span> task1</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;stdio.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;mpi.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#define</span> <span style="color: #6a1868;">N</span> <span style="color: #da8548; font-weight: bold;">1000</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(){
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span>, <span style="color: #6a1868;">rank</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">a</span>[N];
    MPI_Init(<span style="color: #b751b6;">NULL</span>, <span style="color: #b751b6;">NULL</span>);
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">chunksize</span> = N / size;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">start</span> = rank * chunksize;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">end</span> = start + chunksize;
    <span style="color: #e45649;">if</span>(rank == size - <span style="color: #da8548; font-weight: bold;">1</span>) end = N;
    <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = start; i &lt; end; i++){
        a[i] = i + <span style="color: #da8548; font-weight: bold;">1</span>;
    }

    <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = start; i &lt; end; i++){
        printf(<span style="color: #50a14f;">"%d "</span>, a[i]);
    }
    printf(<span style="color: #50a14f;">"\n"</span>);
    MPI_Finalize();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">bash compile.sh task1.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc task1.c -o task1.out
------------------------------------------------------------------
Compilation successful. Check at task1.out
------------------------------------------------------------------
</pre>


<div class="org-src-container">
<pre class="src src-bash">bash run.sh ./task1.out <span style="color: #da8548; font-weight: bold;">4</span> &gt; output.txt
</pre>
</div>
</div>
</div>
<div id="outline-container-orge5a0c28" class="outline-2">
<h2 id="orge5a0c28"><span class="section-number-2">18.</span> Point-to-point communication</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">"stdio.h"</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">"mpi.h"</span>

<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>()
{
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">myid</span>, <span style="color: #6a1868;">size</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">myval</span>;
    MPI_Init(<span style="color: #b751b6;">NULL</span>,<span style="color: #b751b6;">NULL</span>);

    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);

    MPI_Comm_rank(MPI_COMM_WORLD, &amp;myid);

    <span style="color: #e45649;">if</span>(myid==<span style="color: #da8548; font-weight: bold;">0</span>){
        myval = <span style="color: #da8548; font-weight: bold;">100</span>;
        printf(<span style="color: #50a14f;">"\nmyid: %d \t myval = %d"</span>, myid, myval);
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">1</span>; i &lt; size; i++){
            MPI_Send(&amp;myval, <span style="color: #da8548; font-weight: bold;">1</span>, MPI_INT, i, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD);
        }
        printf(<span style="color: #50a14f;">"\nmyid: %d \t Data sent.\n"</span>, myid);
    }
    <span style="color: #e45649;">else</span>{   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Process with ID exactly equal to 1</span>
        <span style="color: #e45649;">if</span>(myid == size - <span style="color: #da8548; font-weight: bold;">1</span>){
            printf(<span style="color: #50a14f;">"I left\n"</span>);
        }
        <span style="color: #e45649;">else</span>{
               myval = <span style="color: #da8548; font-weight: bold;">200</span>;
               MPI_Recv(&amp;myval, <span style="color: #da8548; font-weight: bold;">1</span>, MPI_INT, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
               printf(<span style="color: #50a14f;">"\nmyid: %d \t Data received.\n"</span>, myid);
               printf(<span style="color: #50a14f;">"\nmyid: %d \t myval = %d\n"</span>, myid, myval);
        }
    }

    MPI_Finalize();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">bash compile.sh p2p_mpi.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc p2p_mpi.c -o p2p_mpi.out
------------------------------------------------------------------
Compilation successful. Check at p2p_mpi.out
------------------------------------------------------------------
</pre>


<div class="org-src-container">
<pre class="src src-bash">bash run.sh ./p2p_mpi.out <span style="color: #da8548; font-weight: bold;">4</span>
</pre>
</div>

<pre class="example" id="org6ef941d">
------------------------------------------------------------------
Command executed: mpirun -np 4 ./p2p_mpi.out
------------------------------------------------------------------
##################################################################
##########                    OUTPUT                    ##########
##################################################################

I left

myid: 0 	 myval = 100
myid: 0 	 Data sent.

myid: 2 	 Data received.

myid: 2 	 myval = 100

myid: 1 	 Data received.

myid: 1 	 myval = 100

##################################################################
##########                     DONE                     ##########
##################################################################
</pre>
</div>
<div id="outline-container-org057d2fe" class="outline-3">
<h3 id="org057d2fe"><span class="section-number-3">18.1.</span> Sending array to process 1</h3>
<div class="outline-text-3" id="text-18-1">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">"stdio.h"</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">"mpi.h"</span>
<span style="color: #4078f2; font-weight: bold;">#define</span> <span style="color: #6a1868;">N</span> <span style="color: #da8548; font-weight: bold;">100</span>

<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>()
{
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">myid</span>, <span style="color: #6a1868;">size</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">myval</span>;

    <span style="color: #986801;">int</span> <span style="color: #6a1868;">arr</span>[N];
    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Initialize MPI environment</span>
    MPI_Init(<span style="color: #b751b6;">NULL</span>,<span style="color: #b751b6;">NULL</span>);

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Get total number of processes</span>
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Get my unique ID among all processes</span>
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;myid);

    <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Process with ID exactly equal to 0</span>
    <span style="color: #e45649;">if</span>(myid==<span style="color: #da8548; font-weight: bold;">0</span>){
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Initialize data to be sent</span>
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++) arr[i] = i + <span style="color: #da8548; font-weight: bold;">1</span>;
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Send data</span>
        MPI_Send(arr, N, MPI_INT, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD);
        printf(<span style="color: #50a14f;">"\nmyid: %d \t Data sent.\n"</span>, myid);
    }
    <span style="color: #e45649;">else</span> <span style="color: #e45649;">if</span>(myid==<span style="color: #da8548; font-weight: bold;">1</span>){   <span style="color: #9ca0a4;">// </span><span style="color: #9ca0a4;">Process with ID exactly equal to 1</span>
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Initialize receive array to some other data</span>
        MPI_Recv(arr, N, MPI_INT, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
        printf(<span style="color: #50a14f;">"\nmyid: %d \t Data received.\n"</span>, myid);
        <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">Print received data</span>
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++)
          printf(<span style="color: #50a14f;">"%d "</span>, arr[i]);
    }

    <span style="color: #9ca0a4;">//</span><span style="color: #9ca0a4;">End MPI environment</span>
    MPI_Finalize();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">bash compile.sh p2p_mpi_array.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc p2p_mpi_array.c -o p2p_mpi_array.out
------------------------------------------------------------------
Compilation successful. Check at p2p_mpi_array.out
------------------------------------------------------------------
</pre>


<div class="org-src-container">
<pre class="src src-bash">bash run.sh ./p2p_mpi_array.out <span style="color: #da8548; font-weight: bold;">2</span>
</pre>
</div>

<pre class="example" id="org4434287">
------------------------------------------------------------------
Command executed: mpirun -np 2 ./p2p_mpi_array.out
------------------------------------------------------------------
##################################################################
##########                    OUTPUT                    ##########
##################################################################


myid: 1 	 Data received.

myid: 0 	 Data sent.
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 
##################################################################
##########                     DONE                     ##########
##################################################################
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcad3e0f" class="outline-2">
<h2 id="orgcad3e0f"><span class="section-number-2">19.</span> Point to point communication</h2>
<div class="outline-text-2" id="text-19">
<p>
This will create 1000 send calls and 1000 recv calls which is not good for your network.
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;stdio.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;mpi.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#define</span> <span style="color: #6a1868;">N</span> <span style="color: #da8548; font-weight: bold;">1000</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(){
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span>, <span style="color: #6a1868;">rank</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">a</span>[N];
    MPI_Init(<span style="color: #b751b6;">NULL</span>, <span style="color: #b751b6;">NULL</span>);
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
    <span style="color: #e45649;">if</span>(rank == <span style="color: #da8548; font-weight: bold;">0</span>){
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++){
                a[i] = i + <span style="color: #da8548; font-weight: bold;">1</span>;
        }

        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++){
            MPI_Send(&amp;a[i], <span style="color: #da8548; font-weight: bold;">1</span>, MPI_INT, <span style="color: #da8548; font-weight: bold;">1</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD);
        }
    }
    <span style="color: #e45649;">else</span>{
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++){
            MPI_Recv(&amp;a[i], <span style="color: #da8548; font-weight: bold;">1</span>, MPI_INT, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
        }
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = N - <span style="color: #da8548; font-weight: bold;">10</span>; i &lt; N; i++){
            printf(<span style="color: #50a14f;">"%d "</span>, a[i]);
        }
    }

    MPI_Finalize();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">bash compile.sh p2p.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc p2p.c -o p2p.out
------------------------------------------------------------------
Compilation successful. Check at p2p.out
------------------------------------------------------------------
</pre>


<div class="org-src-container">
<pre class="src src-bash">bash run.sh ./p2p.out <span style="color: #da8548; font-weight: bold;">2</span>
</pre>
</div>

<pre class="example" id="org6ed4dfa">
------------------------------------------------------------------
Command executed: mpirun -np 2 ./p2p.out
------------------------------------------------------------------
##################################################################
##########                    OUTPUT                    ##########
##################################################################

991 992 993 994 995 996 997 998 999 1000 
##################################################################
##########                     DONE                     ##########
##################################################################
</pre>
</div>
<div id="outline-container-orge995282" class="outline-3">
<h3 id="orge995282"><span class="section-number-3">19.1.</span> Better way</h3>
<div class="outline-text-3" id="text-19-1">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;stdio.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#include</span><span style="color: #50a14f;">&lt;mpi.h&gt;</span>
<span style="color: #4078f2; font-weight: bold;">#define</span> <span style="color: #6a1868;">N</span> <span style="color: #da8548; font-weight: bold;">1000</span>
<span style="color: #986801;">int</span> <span style="color: #a626a4;">main</span>(){
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">size</span>, <span style="color: #6a1868;">rank</span>;
    <span style="color: #986801;">int</span> <span style="color: #6a1868;">a</span>[N];
    MPI_Init(<span style="color: #b751b6;">NULL</span>, <span style="color: #b751b6;">NULL</span>);
    MPI_Comm_size(MPI_COMM_WORLD, &amp;size);
    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
    <span style="color: #e45649;">if</span>(rank == <span style="color: #da8548; font-weight: bold;">0</span>){
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">0</span>; i &lt; N; i++){
                a[i] = i + <span style="color: #da8548; font-weight: bold;">1</span>;
        }


        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = <span style="color: #da8548; font-weight: bold;">1</span>; i &lt; size; i++){
            MPI_Send(a, N, MPI_INT, i, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD);
        }
    }
    <span style="color: #e45649;">else</span>{
        MPI_Recv(a, N, MPI_INT, <span style="color: #da8548; font-weight: bold;">0</span>, <span style="color: #da8548; font-weight: bold;">0</span>, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
        <span style="color: #e45649;">for</span>(<span style="color: #986801;">int</span> <span style="color: #6a1868;">i</span> = N - <span style="color: #da8548; font-weight: bold;">10</span>; i &lt; N; i++){
            printf(<span style="color: #50a14f;">"%d "</span>, a[i]);
        }
        printf(<span style="color: #50a14f;">"\n"</span>);
    }

    MPI_Finalize();
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-bash">bash compile.sh p2p1.c
</pre>
</div>

<pre class="example">
------------------------------------------------------------------
Command executed: mpicc p2p1.c -o p2p1.out
------------------------------------------------------------------
Compilation successful. Check at p2p1.out
------------------------------------------------------------------
</pre>


<div class="org-src-container">
<pre class="src src-bash">bash run.sh ./p2p1.out <span style="color: #da8548; font-weight: bold;">10</span>
</pre>
</div>

<pre class="example" id="org2959dd0">
------------------------------------------------------------------
Command executed: mpirun -np 10 ./p2p1.out
------------------------------------------------------------------
##################################################################
##########                    OUTPUT                    ##########
##################################################################

991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 
991 992 993 994 995 996 997 998 999 1000 

##################################################################
##########                     DONE                     ##########
##################################################################
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Abhishek Raj</p>
<p class="date">Created: 2025-01-03 Fri 12:06</p>
</div>
</body>
</html>
